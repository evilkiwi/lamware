<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.53">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="description" content="Middleware is the core feature of Lamware"><title>Middleware | Lamware</title>
    <link rel="preload" href="/lamware/assets/style.dcdf0d3e.css" as="style" /><link rel="stylesheet" href="/lamware/assets/style.dcdf0d3e.css" />
    <link rel="modulepreload" href="/lamware/assets/app.1a944c02.js"><link rel="modulepreload" href="/lamware/assets/middleware.html.1884cf61.js"><link rel="modulepreload" href="/lamware/assets/middleware.html.7a47b5e1.js"><link rel="prefetch" href="/lamware/assets/index.html.0dbcc86f.js" as="script" /><link rel="prefetch" href="/lamware/assets/getting-started.html.4647788f.js" as="script" /><link rel="prefetch" href="/lamware/assets/usage.html.a830543e.js" as="script" /><link rel="prefetch" href="/lamware/assets/404.html.bd143750.js" as="script" /><link rel="prefetch" href="/lamware/assets/index.html.08207fc4.js" as="script" /><link rel="prefetch" href="/lamware/assets/getting-started.html.37c18d6b.js" as="script" /><link rel="prefetch" href="/lamware/assets/usage.html.32fdae45.js" as="script" /><link rel="prefetch" href="/lamware/assets/404.html.7a33fd0a.js" as="script" />
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/lamware/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt="Lamware"><span class="site-name can-hide">Lamware</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/evilkiwi/lamware" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/evilkiwi/lamware" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Introduction <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/lamware/getting-started.html" class="sidebar-item" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a><!----></li><li><a href="/lamware/usage.html" class="sidebar-item" aria-label="Usage"><!--[--><!--]--> Usage <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Middleware"><!--[--><!--]--> Middleware <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lamware/middleware.html#official-middleware" class="router-link-active router-link-exact-active sidebar-item" aria-label="Official Middleware"><!--[--><!--]--> Official Middleware <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html#third-party-middleware" class="router-link-active router-link-exact-active sidebar-item" aria-label="Third-Party Middleware"><!--[--><!--]--> Third-Party Middleware <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html#developing-middleware" class="router-link-active router-link-exact-active sidebar-item" aria-label="Developing Middleware"><!--[--><!--]--> Developing Middleware <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lamware/middleware.html#hooks" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hooks"><!--[--><!--]--> Hooks <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html#state" class="router-link-active router-link-exact-active sidebar-item" aria-label="State"><!--[--><!--]--> State <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html#initialization" class="router-link-active router-link-exact-active sidebar-item" aria-label="Initialization"><!--[--><!--]--> Initialization <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html#handling-errors" class="router-link-active router-link-exact-active sidebar-item" aria-label="Handling Errors"><!--[--><!--]--> Handling Errors <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html#wrapping-the-handler" class="router-link-active router-link-exact-active sidebar-item" aria-label="Wrapping the Handler"><!--[--><!--]--> Wrapping the Handler <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html#filter" class="router-link-active router-link-exact-active sidebar-item" aria-label="Filter"><!--[--><!--]--> Filter <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lamware/middleware.html#middleware-purity" class="router-link-active router-link-exact-active sidebar-item" aria-label="Middleware Purity"><!--[--><!--]--> Middleware Purity <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="middleware" tabindex="-1"><a class="header-anchor" href="#middleware" aria-hidden="true">#</a> Middleware</h1><p>Lamware is built around the idea of Middleware being used to modify and transform a function. Middleware comes down to being a plain object, which can optionally define various hooks and wrappers.</p><h2 id="official-middleware" tabindex="-1"><a class="header-anchor" href="#official-middleware" aria-hidden="true">#</a> Official Middleware</h2><p>We maintain some basic and useful Middleware over <a href="https://github.com/evilkiwi/lamware/tree/master/packages" target="_blank" rel="noopener noreferrer">in our GitHub repo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><ul><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/apollo" target="_blank" rel="noopener noreferrer">@lamware/apollo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Set-up and memoize Apollo Server in AWS Lambda</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/appconfig" target="_blank" rel="noopener noreferrer">@lamware/appconfig<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Fetch your JSON config from AWS AppConfig &amp; type it</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/do-not-wait" target="_blank" rel="noopener noreferrer">@lamware/do-not-wait<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Ensure <code>callbackWaitsForEmptyEventLoop</code> is set to <code>false</code> for your function</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/fastify" target="_blank" rel="noopener noreferrer">@lamware/fastify<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Set-up Fastify in Lambda implementing best practises and giving access to Lamware state</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/memoize" target="_blank" rel="noopener noreferrer">@lamware/memoize<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Helper Middleware for you to memoize anything in a type-safe way</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/powertools-logger" target="_blank" rel="noopener noreferrer">@lamware/powertools-logger<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Utilize the Official Lambda TypeScript Logging system</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/powertools-metrics" target="_blank" rel="noopener noreferrer">@lamware/powertools-metrics<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Utilize the Official Lambda TypeScript Metrics system</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/powertools-tracing" target="_blank" rel="noopener noreferrer">@lamware/powertools-tracing<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Utilize the Official Lambda TypeScript X-ray Tracing system</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/prisma" target="_blank" rel="noopener noreferrer">@lamware/prisma<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Set-up and memoize your Prisma Client</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/secrets-manager" target="_blank" rel="noopener noreferrer">@lamware/secrets-manager<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Fetch &amp; type secret values from AWS Secrets Manager</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/sentry" target="_blank" rel="noopener noreferrer">@lamware/sentry<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Wrap your function for Sentry Issue tracking</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/sqs-json-parser" target="_blank" rel="noopener noreferrer">@lamware/sqs-json-parser<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Safely parse and type SQS JSON payloads</li><li><a href="https://github.com/evilkiwi/lamware/tree/master/packages/warmer" target="_blank" rel="noopener noreferrer">@lamware/warmer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> - Warm your Lambda functions via <code>lambda-warmer</code></li></ul><h2 id="third-party-middleware" tabindex="-1"><a class="header-anchor" href="#third-party-middleware" aria-hidden="true">#</a> Third-Party Middleware</h2><div class="custom-container tip"><p class="custom-container-title">Hmm</p><p>We don&#39;t have anything here yet. Want to add your own middleware? Open a PR!</p></div><h2 id="developing-middleware" tabindex="-1"><a class="header-anchor" href="#developing-middleware" aria-hidden="true">#</a> Developing Middleware</h2><p>Middleware is, at its core, just an object. You can use the <code>Middleware</code> type from <code>@lamware/core</code> to ensure things are typed correctly.</p><p>One important thing to note is that, whilst not required, providing a <code>Handler</code> type to the <code>Middleware</code> interface is recommended. It will properly type your hooks, as well as providing a type error should someone try to use your Middleware on an unsupported type.</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Alternatively, you can define middleware in-line with the <code>use()</code> function:</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> lamware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> handler <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">lamware</span><span class="token generic class-name"><span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-function"><span class="token function">use</span><span class="token generic class-name"><span class="token operator">&lt;</span>Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> statusCode<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> handler <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="hooks" tabindex="-1"><a class="header-anchor" href="#hooks" aria-hidden="true">#</a> Hooks</h3><p>Lamware provides three runtime hooks:</p><ul><li><code>before</code> - Runs <em>before</em> the Handler is executed.</li><li><code>after</code> - Runs <em>after</em> the Handler is executed.</li><li><code>uncaughtException</code> - Runs if an uncaught exception happens during <code>before</code>, <code>after</code> or the Handler itself. Useful for error/crash reporting, cleaning up after a failure, etc.</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">before</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// You can set state (see below)</span>
        payload<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> helloWorld <span class="token operator">=</span> <span class="token string">&#39;123&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// Or return a response and exit the function early.</span>
        payload<span class="token punctuation">.</span>response <span class="token operator">=</span> <span class="token punctuation">{</span> statusCode<span class="token operator">:</span> <span class="token number">401</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// You can also modify the function event and context.</span>
        payload<span class="token punctuation">.</span>event<span class="token punctuation">.</span>rawPath <span class="token operator">=</span> <span class="token string">&#39;/hello-world&#39;</span><span class="token punctuation">;</span>
        payload<span class="token punctuation">.</span>context<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">after</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// The response here is from the function itself, and you can modify it.</span>
        payload<span class="token punctuation">.</span>response<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">uncaughtException</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> context<span class="token punctuation">,</span> cause <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * See &quot;Handling Errors&quot; below!
         */</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="state" tabindex="-1"><a class="header-anchor" href="#state" aria-hidden="true">#</a> State</h3><p>Middleware is stateless, other than modifying its own custom state object, which will be merged in to the state used by the function. You can provide typings for this state, which will also be merged and used in the function handler.</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    helloWorld<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> State<span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">before</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        payload<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            helloWorld <span class="token operator">=</span> <span class="token string">&#39;123&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="initialization" tabindex="-1"><a class="header-anchor" href="#initialization" aria-hidden="true">#</a> Initialization</h3><p>Middleware can provide an <code>init</code> function which will be called before the Lambda function is executed. This is useful for memoizing instances in to state, fetching data from an API, or any other asynchronous operation.</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    helloWorld<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> State<span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Pull data from API etc.</span>

        <span class="token comment">// You can also return your initial state here.</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            helloWorld<span class="token operator">:</span> <span class="token string">&#39;123&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="handling-errors" tabindex="-1"><a class="header-anchor" href="#handling-errors" aria-hidden="true">#</a> Handling Errors</h3><p>As mentioned previously, Lamware has an <code>uncaughtException</code> hook. If provided, this will be executed whenever an uncaught exception occurs within:</p><ul><li><code>before</code> hooks</li><li><code>after</code> hooks</li><li><code>execute()</code> handler</li></ul><p>You can use this to log errors, handle clean-up and anything else that you might want to do if all else fails.</p><p><strong>Note:</strong> If an uncaught exception happens during the <code>uncaughtException</code> hook, it will be thrown top-level. It&#39;s important to catch these yourself if you don&#39;t want anything to potentially return an error for the Lambda Function. For example, if you report errors to an external service via <code>uncaughtException</code>, wrap in a <code>try/catch</code> as the external service may go down.</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">uncaughtException</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> exception <span class="token punctuation">}</span> <span class="token operator">=</span> payload<span class="token punctuation">.</span>cause<span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * `exception` is the `Error` instance that caused the
         * `uncaughtException` hook to run.
         */</span>
        <span class="token keyword">await</span> <span class="token function">sendToSentry</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * You should also provide a response. By default it will
         * be an empty object, which will break for APIG v1/v2.
         */</span>
        payload<span class="token punctuation">.</span>response <span class="token operator">=</span> <span class="token punctuation">{</span>
            statusCode<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hello<span class="token operator">:</span> <span class="token string">&#39;world&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="wrapping-the-handler" tabindex="-1"><a class="header-anchor" href="#wrapping-the-handler" aria-hidden="true">#</a> Wrapping the Handler</h3><p>Sometimes you need to wrap your Handler, for example when using Sentry to allow it to capture handler errors. Through a Lamware middleware, you can provide a wrapper function that will automatically be used for the executed handler.</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">wrap</span><span class="token operator">:</span> handler <span class="token operator">=&gt;</span> handler<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the cases where, for example Sentry, you have to provide a regular handler (<code>(event, context, callback) =&gt; {}</code>) instead of the object-based Lamware one, you can use our <code>wrapCompat</code> function to wrap using the compatibility wrapper:</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AWSLambda <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@sentry/serverless&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> wrapCompat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">wrap</span><span class="token operator">:</span> handler <span class="token operator">=&gt;</span> <span class="token function">wrapCompat</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> compatHandler <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> AWSLambda<span class="token punctuation">.</span><span class="token function">wrapHandler</span><span class="token punctuation">(</span>compatHandler<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            captureTimeoutWarning<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            rethrowAfterCapture<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            callbackWaitsForEmptyEventLoop<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token operator">...</span><span class="token punctuation">(</span>config<span class="token operator">?.</span>wrapper <span class="token operator">??</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="filter" tabindex="-1"><a class="header-anchor" href="#filter" aria-hidden="true">#</a> Filter</h3><p>Sometimes you may want your Middleware to <em>not</em> be registered, even if the user has added it via <code>.use()</code>. To achieve this, you can implement the <strong>synchronous</strong> <code>filter()</code> function:</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">filter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// Returning `false` will prevent the Middleware being registered.</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="middleware-purity" tabindex="-1"><a class="header-anchor" href="#middleware-purity" aria-hidden="true">#</a> Middleware Purity</h3><p>When running Middleware hooks, Lamware will run them in parallel. This improves performance, but should your Middleware modify the state in some way (i.e. changing the Lambda <code>context</code> or anything else in the <code>payload</code>) you should tell Lamware that the Middleware <strong>isn&#39;t pure.</strong></p><p>By telling Lamware that your Middleware isn&#39;t pure, it will be sure to run it alone. The order in which Middleware hooks are executed is based on the order the Developer registers them in via <code>.use()</code>, so if your impure Middleware is registered between two pure Middlewares, it will break the chain and run your impure Middleware inbetween them.</p><p>You can do this via the <code>pure</code> property of Middleware:</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> APIGatewayProxyHandlerV2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;aws-lambda&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@lamware/core&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Middleware<span class="token operator">&lt;</span>APIGatewayProxyHandlerV2<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;my-middleware&#39;</span><span class="token punctuation">,</span>
    pure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// `true` by default.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/evilkiwi/lamware/edit/master/docs/content/middleware.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: tom@mosey.dev">OYED</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/lamware/usage.html" class="" aria-label="Usage"><!--[--><!--]--> Usage <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/lamware/assets/app.1a944c02.js" defer></script>
  </body>
</html>
